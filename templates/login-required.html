<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign in required - Roxli Account</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            background: white;
            border-radius: 16px;
            padding: 48px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 480px;
            width: 100%;
        }

        .logo-section {
            margin-bottom: 32px;
        }

        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 16px;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 600;
            color: #202124;
            margin-bottom: 8px;
        }

        .logo-subtitle {
            color: #5f6368;
            font-size: 16px;
        }

        .content-section {
            margin-bottom: 32px;
        }

        .content-section h1 {
            font-size: 28px;
            color: #202124;
            margin-bottom: 16px;
        }

        .content-section p {
            color: #5f6368;
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 24px;
        }

        .features-list {
            list-style: none;
            text-align: left;
            margin-bottom: 32px;
        }

        .features-list li {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            color: #5f6368;
            font-size: 14px;
        }

        .features-list i {
            width: 20px;
            height: 20px;
            background: #e8f5e8;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #34a853;
            font-size: 10px;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .btn-primary {
            padding: 14px 24px;
            background: linear-gradient(135deg, #1a73e8, #4285f4);
            color: white;
            border: none;
            border-radius: 24px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
        }

        .btn-secondary {
            padding: 12px 24px;
            background: none;
            color: #1a73e8;
            border: 1px solid #dadce0;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-secondary:hover {
            background: #f8f9fa;
            border-color: #1a73e8;
        }

        .security-note {
            margin-top: 24px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 12px;
            color: #5f6368;
            line-height: 1.4;
        }

        .security-note i {
            color: #34a853;
            margin-right: 6px;
        }

        @media (max-width: 600px) {
            .login-container {
                padding: 32px 24px;
            }

            .logo {
                width: 64px;
                height: 64px;
                font-size: 24px;
            }

            .logo-text {
                font-size: 20px;
            }

            .content-section h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="logo-section">
            <div class="logo">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Roxli" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                <div style="display: none; width: 80px; height: 80px; background: linear-gradient(135deg, #1a73e8, #4285f4); border-radius: 20px; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold;">R</div>
            </div>
            <div class="logo-text">Roxli Account</div>
            <div class="logo-subtitle">Secure account management</div>
        </div>

        <div class="content-section">
            <h1>Sign in required</h1>
            <p>You need to sign in to access your Roxli Account dashboard and manage your settings.</p>
            
            <ul class="features-list">
                <li>
                    <i class="fas fa-check"></i>
                    Manage your personal information
                </li>
                <li>
                    <i class="fas fa-check"></i>
                    Control your security settings
                </li>
                <li>
                    <i class="fas fa-check"></i>
                    Review your connected devices
                </li>
                <li>
                    <i class="fas fa-check"></i>
                    Manage app permissions
                </li>
            </ul>
        </div>

        <div class="action-buttons">
            <button onclick="openSignInPopup()" class="btn-primary">
                Sign in to your account
            </button>
            <button onclick="openRegisterPopup()" class="btn-secondary">
                Create new account
            </button>
        </div>

        <div class="security-note">
            <i class="fas fa-shield-alt"></i>
            Your account is protected with industry-standard security measures including encryption and secure authentication.
        </div>
    </div>

    <script>
        // Check if user is already logged in
        document.addEventListener('DOMContentLoaded', function() {
            // Try to get token from cookie
            const token = getCookie('roxli_token');
            if (token) {
                // Verify token with server
                fetch('/api/auth-check')
                    .then(response => {
                        if (response.ok) {
                            // User is authenticated, redirect to dashboard
                            window.location.href = '/';
                        }
                    })
                    .catch(error => {
                        console.log('Auth check failed:', error);
                    });
            }
        });

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        function openSignInPopup() {
            const popup = window.open('https://auth.roxli.in/popup', 'roxli-auth', 'width=400,height=600,scrollbars=yes,resizable=yes');
            
            const messageHandler = function(event) {
                if (event.origin !== 'https://auth.roxli.in') return;
                
                if (event.data.type === 'ROXLI_AUTH_SUCCESS') {
                    popup.close();
                    window.removeEventListener('message', messageHandler);
                    
                    // Set token and redirect to dashboard
                    fetch('/api/set-token', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ token: event.data.token })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            window.location.href = '/';
                        } else {
                            alert('Authentication failed. Please try again.');
                        }
                    })
                    .catch(error => {
                        console.error('Auth error:', error);
                        alert('Authentication failed. Please try again.');
                    });
                }
            };
            
            window.addEventListener('message', messageHandler);
        }

        function openRegisterPopup() {
            const popup = window.open('https://auth.roxli.in/popup?mode=register', 'roxli-register', 'width=400,height=650,scrollbars=yes,resizable=yes');
            
            const messageHandler = function(event) {
                if (event.origin !== 'https://auth.roxli.in') return;
                
                if (event.data.type === 'ROXLI_AUTH_SUCCESS') {
                    popup.close();
                    window.removeEventListener('message', messageHandler);
                    
                    // Set token and redirect to dashboard
                    fetch('/api/set-token', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ token: event.data.token })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            window.location.href = '/';
                        } else {
                            alert('Registration failed. Please try again.');
                        }
                    })
                    .catch(error => {
                        console.error('Auth error:', error);
                        alert('Registration failed. Please try again.');
                    });
                }
            };
            
            window.addEventListener('message', messageHandler);
        }
    </script>
</body>
</html>